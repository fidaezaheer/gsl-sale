<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="0">
        <record id="view_order_form_gs" model="ir.ui.view">
            <field name="name">view_order_form_gs</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form" />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='validity_date']" position="before">
                    <field name="disposition_type_id" required="1" />
                    <field name="from_phase_id" invisible="1" force_save="1"/>
                </xpath>
                <field name="partner_shipping_id" position="after">
                    <field name="tag_ids" />
                </field>
                <xpath expr="//field[@name='order_line']/tree/field[@name='product_uom_qty']" position="before">
                    <field name="requested_qty" />            
                    <field name="virtual_available" />            
                </xpath>
                <xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="attributes">
                    <attribute name="domain">[('phase_id','=',parent.from_phase_id)]</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']/tree/field[@name='tax_id']" position="attributes">
                    <attribute name="groups">base.group_no_one</attribute>
                </xpath>
                
                <xpath expr="//field[@name='amount_untaxed']" position="attributes">
                    <attribute name="groups">base.group_no_one</attribute>                    
                </xpath>
                <xpath expr="//field[@name='amount_tax']" position="attributes">
                    <attribute name="groups">base.group_no_one</attribute>                    
                </xpath>
                <button name="action_cancel" position="attributes">
                    <attribute name="confirm">Are you sure you want to cancel the entire request?</attribute>
                </button>
                <xpath expr="//page[last()]" position="after">
                    <page string="PDP and TOT Fields" >
                        <group>
                            <group>
                                <field name="loading_dock" />
                                <field name="trailers" />
                            </group>
                            <group>
                                <field name="mailout" groups="base.group_no_one"/>
                            </group>
                        </group>
                        <group string="Delivery informations">
                            <field name="expected_delivery_date" widget="note" placeholder="Expected Delivery Date" />
                            <field name="preferred_delivery_date" widget="note" placeholder="Preferred Delivery Date" />
                            <field name="operating_hours" widget="note" placeholder="Operating hours" />
                            <field name="intend" widget="note" placeholder="Intend to use this furniture for" />
                            <field name="offload" widget="note" placeholder="Describe offloading environment" />
                        </group>
                    </page>
                </xpath>                
                <xpath expr="//header[1]//button[last()]" position="after">
                    <button name="action_tot" type="object" string="Print TOT" attrs="{'invisible': [('state', 'in', ('draft','sent','cancel'))]}"/>
                    <button name="action_post" type="object" string="Post" attrs="{'invisible': [('state', 'not in', ('draft'))]}"/>
                </xpath>
            </field>
        </record>
        
        
        <!-- <record id="action_print_tot_server" model="ir.actions.server">
            <field name="type">ir.actions.server</field>
            <field name="name">Print TOT</field>
            <field name="model_id" ref="sale.model_sale_order" />
            <field name="binding_model_id" ref="sale.model_sale_order" />
            <field name="sequence" eval="10000" />
            <field name="state">code</field>
            <field name="code">action = records.action_print_tot()</field>
        </record> -->
        
        <record id="requests_tree_view" model="ir.ui.view">
            <field name="name">requests_tree_view</field>
            <field name="model">sale.order.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree editable="top">
                    <field name="company_id" invisible="True"/>
                    <field name="order_partner_id" required="True"/>
                    <field name="product_id" required="True" />
                    <field name="disposition_type_id" required="True" domain="[('manual_create','=',True)]" options="{'no_create': True, 'no_open': True, 'no_create_edit': True}" />
                    <field name="salesman_id" />
                    <field name="virtual_available" />
                    <field name="requested_qty" />
                    <field name="product_uom_qty" />
                </tree>                
            </field>
        </record>
        
        <record id="view_sales_order_line_filter" model="ir.ui.view">
            <field name="name">view_sales_order_line_filter</field>
            <field name="model">sale.order.line</field>
            <field name="inherit_id" ref="sale.view_sales_order_line_filter" />
            <field name="arch" type="xml">
                <xpath expr="//field[last()]" position="after">
                    <field name="phase_id" />
                    <filter string="Selected" name="selected_requests" domain="[('tag_ids','ilike','selected')]"/>
                    <filter string="Requests pending" name="pending_requests" domain="[('state','=','sent')]"/>
                    <filter string="Requests approved" name="approved_requests" domain="[('state','in',('sale','done'))]"/>
                    <filter string="All requests" name="all_requests" domain="[('state','in',('sent','sale','done'))]"/>
                </xpath>
            </field>
        </record>

        
        <record id="gs_sale_order_filters" model="ir.ui.view">
            <field name="name">gs_sale_order_filters</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter" />
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='my_sale_orders_filter']" position="before">
                    <filter string="Selected" name="selected_requests" domain="[('tag_ids','ilike','selected')]"/>
                    <filter string="Requests pending" domain="[('state', '=', 'sent')]" name="requests_pending"/>
                    <filter string="Confirmed requests" domain="[('state', 'in', ('sale', 'done'))]" name="requests_confirmed"/>
                </xpath>
            </field>
        </record>
        <record id="view_order_tree_total" model="ir.ui.view">
            <field name="name">view_order_tree_total</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree" />
            <field name="arch" type="xml">
                <xpath expr="//field[last()]" position="before">
                    <field name="total_requested_qty" optional="show"/>
                    <field name="total_approved_qty" optional="show"/>
                    <field name="total_delivered_qty" optional="show"/>
                </xpath>
                <field name="partner_id" position="before">
                    <field name="parent_partner_id" optional="show"/>
                </field>
                <field name="partner_id" position="after">
                    <field name="disposition_type_id" optional="show"/>
                </field>
                <field name="name" position="attributes">
                    <attribute name="string">Request Number</attribute>
                </field>
                <field name="date_order" position="attributes">
                    <attribute name="string">Request Date</attribute>
                </field>
            </field>
        </record>
        <record id="requests_reset_approved" model="ir.actions.server">
            <field name="name">Reset quantity to approve</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="binding_model_id" ref="sale.model_sale_order"/>
            <field name="binding_view_types">form,list</field>
            <field name="state">code</field>
            <field name="code">records.action_reset_approved()</field>
        </record>
        <record id="requests_line_reset_approved" model="ir.actions.server">
            <field name="name">Reset quantity to approve</field>
            <field name="model_id" ref="sale.model_sale_order_line"/>
            <field name="binding_model_id" ref="sale.model_sale_order_line"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">records.action_reset_approved()</field>
        </record>

    </data>
</odoo>
